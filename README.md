	HTTPЗапрос = новый HTTPЗапрос("/latest.js");     
	
	HTTPСоединение = новый HTTPСоединение("www.cbr-xml-daily.ru",443,,,,100,новый ЗащищенноеСоединениеOpenSSL());
	
	Ответ = HTTPСоединение.ВызватьHTTPМетод("GET", HTTPЗапрос);
	
	ВалютыСтр = "CNY,USD,EUR";
	МассивВалют = СтрРазделить(ВалютыСтр,",");
	
	Если Ответ.КодСостояния = 200 Тогда
		ЧтениеJSON = новый ЧтениеJSON;
		ЧтениеJSON.УстановитьСтроку(Ответ.ПолучитьТелоКакСтроку(КодировкаТекста.UTF8));
		Результат = ПрочитатьJSON(ЧтениеJSON);
		
		Валюты.Очистить();
		Для каждого Стр из Результат.rates Цикл
			
			Если МассивВалют.Найти(Стр.Ключ) <> Неопределено Тогда
				НоваяСтр = Валюты.Добавить();
				НоваяСтр.Валюта = Стр.Ключ + " " + Строка(Стр.Значение);
			КонецЕсли;
		КонецЦикла;
		
	КонецЕсли;

# http


Функция stockGETStock(Запрос)
	Ответ = Новый HTTPСервисОтвет(200);
	
	Заголовки = Новый Соответствие;
	Заголовки.Вставить("Content-Type", "application/json; charset=utf-8");
	
	JSONСтрока = ПолучитьJSON();
	
	Ответ.УстановитьТелоИзСтроки(JSONСтрока, "UTF-8");
	
	Ответ.Заголовки = Заголовки;	
	
	Возврат Ответ; 
	
КонецФункции

Функция ПолучитьJSON(Склад = "")

	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ОстаткиНоменклатурыОстатки.Склад.Наименование КАК Склад
		|ИЗ
		|	РегистрНакопления.ОстаткиНоменклатуры.Остатки КАК ОстаткиНоменклатурыОстатки
		|ГДЕ
		|	ВЫБОР
		|			КОГДА &Склад <> """"
		|				ТОГДА ОстаткиНоменклатурыОстатки.Склад.Наименование = &Склад
		|			ИНАЧЕ ИСТИНА
		|		КОНЕЦ";
	
	Запрос.УстановитьПараметр("Склад", Склад);
    ТелоЗапроса = новый Массив;
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Пока Выборка.Следующий() Цикл
		
		СтруктураСклада = новый Структура;
		СтруктураСклада.Вставить("Склад", Выборка.Склад); 
		
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ОстаткиНоменклатурыОстатки.Номенклатура.Наименование КАК Номенклатура,
		|	ОстаткиНоменклатурыОстатки.КоличествоОстаток КАК Количество
		|ИЗ
		|	РегистрНакопления.ОстаткиНоменклатуры.Остатки КАК ОстаткиНоменклатурыОстатки
		|ГДЕ
		|	ОстаткиНоменклатурыОстатки.Склад.Наименование = &Склад";
		
		Запрос.УстановитьПараметр("Склад", Выборка.Склад);
		
		ВыборкаНоменклатуры = Запрос.Выполнить().Выбрать();
		
		МассивНоменклатур = новый массив;
		
		Пока ВыборкаНоменклатуры.Следующий() Цикл 
			СтруктураНоменклатуры = новый Структура; 
			СтруктураНоменклатуры.Вставить("Номенклатура", ВыборкаНоменклатуры.Номенклатура);
			СтруктураНоменклатуры.Вставить("Количество", ВыборкаНоменклатуры.Количество);
			
			МассивНоменклатур.Добавить(СтруктураНоменклатуры);
		КонецЦикла;
		
		
		
		СтруктураСклада.Вставить("Номенклатуры", МассивНоменклатур);
		ТелоЗапроса.Добавить(СтруктураСклада);
	КонецЦикла;
	
	ПараметрыJSON    = Новый ПараметрыЗаписиJSON(ПереносСтрокJSON.Нет, " " , Истина, ЭкранированиеСимволовJSON.Нет, Ложь, Ложь, Ложь, Ложь);
	ЗаписьJSON        = Новый ЗаписьJSON;
	ЗаписьJSON.ПроверятьСтруктуру = Истина;
	ЗаписьJSON.УстановитьСтроку(ПараметрыJSON); 
	
	ЗаписатьJSON(ЗаписьJSON, ТелоЗапроса);
	ЗапросJSON = ЗаписьJSON.Закрыть();
	
	Возврат ЗапросJSON;

КонецФункции // ПолучитJSON()

Функция StockWarehouseStockWarehouse(Запрос) 
	
	Ответ = Новый HTTPСервисОтвет(200);
	Склад = Запрос.ПараметрыURL["warehouse"];
	
	Заголовки = Новый Соответствие;
	Заголовки.Вставить("Content-Type", "application/json; charset=utf-8");
	
	JSONСтрока = ПолучитьJSON(Склад);
	
	Ответ.УстановитьТелоИзСтроки(JSONСтрока, "UTF-8");
	
	Ответ.Заголовки = Заголовки;	
	
	Возврат Ответ;

КонецФункции
